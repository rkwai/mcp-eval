{
  "id": "support_redeem_reward",
  "description": "Agent reviews the reward catalog and redeems a perk for Jasmine Ortiz.",
  "steps": [
    {
      "label": "Agent: Identify Jasmine Ortiz",
      "tool": "support.lookupCustomer",
      "arguments": {
        "email": "jasmine.ortiz@example.com",
        "includeHistory": false
      },
      "capture": {
        "customerId": "customer.id",
        "startingBalance": "customer.pointsBalance"
      },
      "expect": {
        "status": "success",
        "assert": [
          { "path": "customer.name", "contains": "Jasmine" }
        ]
      }
    },
    {
      "label": "Agent: Review catalog for affordable rewards",
      "tool": "support.catalogSnapshot",
      "arguments": {
        "onlyActive": true,
        "maxCost": 10000
      },
      "capture": {
        "targetReward": "rewards[0].id",
        "targetName": "rewards[0].name"
      },
      "expect": {
        "status": "success",
        "assert": [
          { "path": "rewards", "minLength": 1 }
        ]
      }
    },
    {
      "label": "Agent: Redeem first matching reward",
      "tool": "support.redeemReward",
      "arguments": {
        "customerId": "{{customerId}}",
        "rewardId": "{{targetReward}}",
        "channel": "support",
        "note": "gesture of goodwill"
      },
      "capture": {
        "postBalance": "customer.pointsBalance"
      },
      "expect": {
        "status": "success",
        "assert": [
          { "path": "reward.id", "equals": "{{targetReward}}" },
          { "path": "activity.source", "contains": "{{targetName}}" },
          { "path": "customer.pointsBalance", "exists": true }
        ]
      }
    }
  ]
}
